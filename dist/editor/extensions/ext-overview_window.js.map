{"version":3,"file":"ext-overview_window.js","sources":["../../../src/editor/extensions/ext-overview_window.js"],"sourcesContent":["/**\n * @file ext-overview_window.js\n *\n * @license MIT\n *\n * @copyright 2013 James Sacksteder\n *\n */\nexport default {\n  name: 'overview_window',\n  init ({$, isChrome, isIE}) {\n    const overviewWindowGlobals = {};\n    // Disabled in Chrome 48-, see https://github.com/SVG-Edit/svgedit/issues/26 and\n    // https://code.google.com/p/chromium/issues/detail?id=565120.\n    if (isChrome()) {\n      const verIndex = navigator.userAgent.indexOf('Chrome/') + 7;\n      const chromeVersion = Number.parseInt(navigator.userAgent.substring(verIndex));\n      if (chromeVersion < 49) {\n        return undefined;\n      }\n    }\n\n    // Define and insert the base html element.\n    const propsWindowHtml =\n      '<div id=\"overview_window_content_pane\" style=\"width:100%; ' +\n        'word-wrap:break-word;  display:inline-block; margin-top:20px;\">' +\n        '<div id=\"overview_window_content\" style=\"position:relative; ' +\n          'left:12px; top:0px;\">' +\n          '<div style=\"background-color:#A0A0A0; display:inline-block; ' +\n            'overflow:visible;\">' +\n            '<svg id=\"overviewMiniView\" width=\"150\" height=\"100\" x=\"0\" ' +\n              'y=\"0\" viewBox=\"0 0 4800 3600\" ' +\n                'xmlns=\"http://www.w3.org/2000/svg\" ' +\n                'xmlns:xlink=\"http://www.w3.org/1999/xlink\">' +\n              '<use x=\"0\" y=\"0\" xlink:href=\"#svgroot\"> </use>' +\n            '</svg>' +\n            '<div id=\"overview_window_view_box\" style=\"min-width:50px; ' +\n              'min-height:50px; position:absolute; top:30px; left:30px; ' +\n              'z-index:5; background-color:rgba(255,0,102,0.3);\">' +\n            '</div>' +\n          '</div>' +\n        '</div>' +\n      '</div>';\n    $('#sidepanels').append(propsWindowHtml);\n\n    // Define dynamic animation of the view box.\n    const updateViewBox = function () {\n      const portHeight = Number.parseFloat($('#workarea').css('height'));\n      const portWidth = Number.parseFloat($('#workarea').css('width'));\n      const portX = $('#workarea').scrollLeft();\n      const portY = $('#workarea').scrollTop();\n      const windowWidth = Number.parseFloat($('#svgcanvas').css('width'));\n      const windowHeight = Number.parseFloat($('#svgcanvas').css('height'));\n      const overviewWidth = $('#overviewMiniView').attr('width');\n      const overviewHeight = $('#overviewMiniView').attr('height');\n\n      const viewBoxX = portX / windowWidth * overviewWidth;\n      const viewBoxY = portY / windowHeight * overviewHeight;\n      const viewBoxWidth = portWidth / windowWidth * overviewWidth;\n      const viewBoxHeight = portHeight / windowHeight * overviewHeight;\n\n      $('#overview_window_view_box').css('min-width', viewBoxWidth + 'px');\n      $('#overview_window_view_box').css('min-height', viewBoxHeight + 'px');\n      $('#overview_window_view_box').css('top', viewBoxY + 'px');\n      $('#overview_window_view_box').css('left', viewBoxX + 'px');\n    };\n    $('#workarea').scroll(function () {\n      if (!(overviewWindowGlobals.viewBoxDragging)) {\n        updateViewBox();\n      }\n    });\n    $('#workarea').resize(updateViewBox);\n    updateViewBox();\n\n    // Compensate for changes in zoom and canvas size.\n    const updateViewDimensions = function () {\n      const viewWidth = $('#svgroot').attr('width');\n      const viewHeight = $('#svgroot').attr('height');\n\n      let viewX = 640;\n      let viewY = 480;\n      if (isIE()) {\n        // This has only been tested with Firefox 10 and IE 9 (without chrome frame).\n        // I am not sure if if is Firefox or IE that is being non compliant here.\n        // Either way the one that is noncompliant may become more compliant later.\n        // TAG:HACK\n        // TAG:VERSION_DEPENDENT\n        // TAG:BROWSER_SNIFFING\n        viewX = 0;\n        viewY = 0;\n      }\n\n      const svgWidthOld = $('#overviewMiniView').attr('width');\n      const svgHeightNew = viewHeight / viewWidth * svgWidthOld;\n      $('#overviewMiniView').attr('viewBox', viewX + ' ' + viewY + ' ' + viewWidth + ' ' + viewHeight);\n      $('#overviewMiniView').attr('height', svgHeightNew);\n      updateViewBox();\n    };\n    updateViewDimensions();\n\n    // Set up the overview window as a controller for the view port.\n    overviewWindowGlobals.viewBoxDragging = false;\n    const updateViewPortFromViewBox = function () {\n      const windowWidth = Number.parseFloat($('#svgcanvas').css('width'));\n      const windowHeight = Number.parseFloat($('#svgcanvas').css('height'));\n      const overviewWidth = $('#overviewMiniView').attr('width');\n      const overviewHeight = $('#overviewMiniView').attr('height');\n      const viewBoxX = Number.parseFloat($('#overview_window_view_box').css('left'));\n      const viewBoxY = Number.parseFloat($('#overview_window_view_box').css('top'));\n\n      const portX = viewBoxX / overviewWidth * windowWidth;\n      const portY = viewBoxY / overviewHeight * windowHeight;\n\n      $('#workarea').scrollLeft(portX);\n      $('#workarea').scrollTop(portY);\n    };\n    $('#overview_window_view_box').draggable({\n      containment: 'parent',\n      drag: updateViewPortFromViewBox,\n      start () { overviewWindowGlobals.viewBoxDragging = true; },\n      stop () { overviewWindowGlobals.viewBoxDragging = false; }\n    });\n    $('#overviewMiniView').click(function (evt) {\n      // Firefox doesn't support evt.offsetX and evt.offsetY.\n      const mouseX = (evt.offsetX || evt.originalEvent.layerX);\n      const mouseY = (evt.offsetY || evt.originalEvent.layerY);\n      const overviewWidth = $('#overviewMiniView').attr('width');\n      const overviewHeight = $('#overviewMiniView').attr('height');\n      const viewBoxWidth = Number.parseFloat($('#overview_window_view_box').css('min-width'));\n      const viewBoxHeight = Number.parseFloat($('#overview_window_view_box').css('min-height'));\n\n      let viewBoxX = mouseX - 0.5 * viewBoxWidth;\n      let viewBoxY = mouseY - 0.5 * viewBoxHeight;\n      // deal with constraints\n      if (viewBoxX < 0) {\n        viewBoxX = 0;\n      }\n      if (viewBoxY < 0) {\n        viewBoxY = 0;\n      }\n      if (viewBoxX + viewBoxWidth > overviewWidth) {\n        viewBoxX = overviewWidth - viewBoxWidth;\n      }\n      if (viewBoxY + viewBoxHeight > overviewHeight) {\n        viewBoxY = overviewHeight - viewBoxHeight;\n      }\n\n      $('#overview_window_view_box').css('top', viewBoxY + 'px');\n      $('#overview_window_view_box').css('left', viewBoxX + 'px');\n      updateViewPortFromViewBox();\n    });\n\n    return {\n      name: 'overview window',\n      canvasUpdated: updateViewDimensions,\n      workareaResized: updateViewBox\n    };\n  }\n};\n"],"names":["name","init","$","isChrome","isIE","overviewWindowGlobals","verIndex","navigator","userAgent","indexOf","chromeVersion","Number","parseInt","substring","undefined","propsWindowHtml","append","updateViewBox","portHeight","parseFloat","css","portWidth","portX","scrollLeft","portY","scrollTop","windowWidth","windowHeight","overviewWidth","attr","overviewHeight","viewBoxX","viewBoxY","viewBoxWidth","viewBoxHeight","scroll","viewBoxDragging","resize","updateViewDimensions","viewWidth","viewHeight","viewX","viewY","svgWidthOld","svgHeightNew","updateViewPortFromViewBox","draggable","containment","drag","start","stop","click","evt","mouseX","offsetX","originalEvent","layerX","mouseY","offsetY","layerY","canvasUpdated","workareaResized"],"mappings":"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"}