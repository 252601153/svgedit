{"version":3,"file":"ext-markers.js","sources":["../../../src/editor/extensions/ext-markers.js"],"sourcesContent":["/**\n * @file ext-markers.js\n *\n * @license Apache-2.0\n *\n * @copyright 2010 Will Schleter based on ext-arrows.js by Copyright(c) 2010 Alexis Deveria\n *\n * This extension provides for the addition of markers to the either end\n * or the middle of a line, polyline, path, polygon.\n *\n * Markers may be either a graphic or arbitary text\n *\n * to simplify the coding and make the implementation as robust as possible,\n * markers are not shared - every object has its own set of markers.\n * this relationship is maintained by a naming convention between the\n * ids of the markers and the ids of the object\n *\n * The following restrictions exist for simplicty of use and programming\n *    objects and their markers to have the same color\n *    marker size is fixed\n *    text marker font, size, and attributes are fixed\n *    an application specific attribute - se_type - is added to each marker element\n *        to store the type of marker\n *\n * @todo\n *    remove some of the restrictions above\n *    add option for keeping text aligned to horizontal\n *    add support for dimension extension lines\n *\n*/\nexport default {\n  name: 'markers',\n  async init (S) {\n    const strings = await S.importLocale();\n    const svgEditor = this;\n    const {$} = S;\n    const svgCanvas = svgEditor.canvas;\n    const // {svgcontent} = S,\n      addElem = svgCanvas.addSVGElementFromJson;\n    const mtypes = ['start', 'mid', 'end'];\n    const markerPrefix = 'se_marker_';\n    const idPrefix = 'mkr_';\n\n    // note - to add additional marker types add them below with a unique id\n    // and add the associated icon(s) to marker-icons.svg\n    // the geometry is normalized to a 100x100 box with the origin at lower left\n    // Safari did not like negative values for low left of viewBox\n    // remember that the coordinate system has +y downward\n    const markerTypes = {\n      nomarker: {},\n      leftarrow:\n        {element: 'path', attr: {d: 'M0,50 L100,90 L70,50 L100,10 Z'}},\n      rightarrow:\n        {element: 'path', attr: {d: 'M100,50 L0,90 L30,50 L0,10 Z'}},\n      textmarker:\n        {element: 'text', attr: {\n          x: 0, y: 0, 'stroke-width': 0, stroke: 'none',\n          'font-size': 75, 'font-family': 'serif', 'text-anchor': 'left',\n          'xml:space': 'preserve'\n        }},\n      forwardslash:\n        {element: 'path', attr: {d: 'M30,100 L70,0'}},\n      reverseslash:\n        {element: 'path', attr: {d: 'M30,0 L70,100'}},\n      verticalslash:\n        {element: 'path', attr: {d: 'M50,0 L50,100'}},\n      box:\n        {element: 'path', attr: {d: 'M20,20 L20,80 L80,80 L80,20 Z'}},\n      star:\n        {element: 'path', attr: {d: 'M10,30 L90,30 L20,90 L50,10 L80,90 Z'}},\n      xmark:\n        {element: 'path', attr: {d: 'M20,80 L80,20 M80,80 L20,20'}},\n      triangle:\n        {element: 'path', attr: {d: 'M10,80 L50,20 L80,80 Z'}},\n      mcircle:\n        {element: 'circle', attr: {r: 30, cx: 50, cy: 50}}\n    };\n\n    // duplicate shapes to support unfilled (open) marker types with an _o suffix\n    ['leftarrow', 'rightarrow', 'box', 'star', 'mcircle', 'triangle'].forEach((v) => {\n      markerTypes[v + '_o'] = markerTypes[v];\n    });\n\n    /**\n    * @param {Element} elem - A graphic element will have an attribute like marker-start\n    * @param {\"marker-start\"|\"marker-mid\"|\"marker-end\"} attr\n    * @returns {Element} The marker element that is linked to the graphic element\n    */\n    function getLinked (elem, attr) {\n      const str = elem.getAttribute(attr);\n      if (!str) { return null; }\n      const m = str.match(/\\(#(.*)\\)/);\n      // const m = str.match(/\\(#(?<id>.+)\\)/);\n      // if (!m || !m.groups.id) {\n      if (!m || m.length !== 2) {\n        return null;\n      }\n      return svgCanvas.getElem(m[1]);\n      // return svgCanvas.getElem(m.groups.id);\n    }\n\n    /**\n     *\n     * @param {\"start\"|\"mid\"|\"end\"} pos\n     * @param {string} id\n     * @returns {void}\n     */\n    function setIcon (pos, id) {\n      if (id.substr(0, 1) !== '\\\\') { id = '\\\\textmarker'; }\n      const ci = '#' + idPrefix + pos + '_' + id.substr(1);\n      svgEditor.setIcon('#cur_' + pos + '_marker_list', $(ci).children());\n      $(ci).addClass('current').siblings().removeClass('current');\n    }\n\n    let selElems;\n    /**\n     * Toggles context tool panel off/on. Sets the controls with the\n     *   selected element's settings.\n     * @param {boolean} on\n     * @returns {void}\n    */\n    function showPanel (on) {\n      $('#marker_panel').toggle(on);\n\n      if (on) {\n        const el = selElems[0];\n\n        let val, ci;\n        $.each(mtypes, function (i, pos) {\n          const m = getLinked(el, 'marker-' + pos);\n          const txtbox = $('#' + pos + '_marker');\n          if (!m) {\n            val = '\\\\nomarker';\n            ci = val;\n            txtbox.hide(); // hide text box\n          } else {\n            if (!m.attributes.se_type) { return; } // not created by this extension\n            val = '\\\\' + m.attributes.se_type.textContent;\n            ci = val;\n            if (val === '\\\\textmarker') {\n              val = m.lastChild.textContent;\n              // txtbox.show(); // show text box\n            } else {\n              txtbox.hide(); // hide text box\n            }\n          }\n          txtbox.val(val);\n          setIcon(pos, ci);\n        });\n      }\n    }\n\n    /**\n    * @param {string} id\n    * @param {\"\"|\"\\\\nomarker\"|\"nomarker\"|\"leftarrow\"|\"rightarrow\"|\"textmarker\"|\"forwardslash\"|\"reverseslash\"|\"verticalslash\"|\"box\"|\"star\"|\"xmark\"|\"triangle\"|\"mcircle\"} val\n    * @returns {SVGMarkerElement}\n    */\n    function addMarker (id, val) {\n      const txtBoxBg = '#ffffff';\n      const txtBoxBorder = 'none';\n      const txtBoxStrokeWidth = 0;\n\n      let marker = svgCanvas.getElem(id);\n      if (marker) { return undefined; }\n\n      if (val === '' || val === '\\\\nomarker') { return undefined; }\n\n      const el = selElems[0];\n      const color = el.getAttribute('stroke');\n      // NOTE: Safari didn't like a negative value in viewBox\n      // so we use a standardized 0 0 100 100\n      // with 50 50 being mapped to the marker position\n      const strokeWidth = 10;\n      let refX = 50;\n      let refY = 50;\n      let viewBox = '0 0 100 100';\n      let markerWidth = 5;\n      let markerHeight = 5;\n      let seType;\n      if (val.substr(0, 1) === '\\\\') {\n        seType = val.substr(1);\n      } else { seType = 'textmarker'; }\n\n      if (!markerTypes[seType]) { return undefined; } // an unknown type!\n\n      // create a generic marker\n      marker = addElem({\n        element: 'marker',\n        attr: {\n          id,\n          markerUnits: 'strokeWidth',\n          orient: 'auto',\n          style: 'pointer-events:none',\n          se_type: seType\n        }\n      });\n\n      if (seType !== 'textmarker') {\n        const mel = addElem(markerTypes[seType]);\n        const fillcolor = (seType.substr(-2) === '_o')\n          ? 'none'\n          : color;\n\n        mel.setAttribute('fill', fillcolor);\n        mel.setAttribute('stroke', color);\n        mel.setAttribute('stroke-width', strokeWidth);\n        marker.append(mel);\n      } else {\n        const text = addElem(markerTypes[seType]);\n        // have to add text to get bounding box\n        text.textContent = val;\n        const tb = text.getBBox();\n        // alert(tb.x + ' ' + tb.y + ' ' + tb.width + ' ' + tb.height);\n        const pad = 1;\n        const bb = tb;\n        bb.x = 0;\n        bb.y = 0;\n        bb.width += pad * 2;\n        bb.height += pad * 2;\n        // shift text according to its size\n        text.setAttribute('x', pad);\n        text.setAttribute('y', bb.height - pad - tb.height / 4); // kludge?\n        text.setAttribute('fill', color);\n        refX = bb.width / 2 + pad;\n        refY = bb.height / 2 + pad;\n        viewBox = bb.x + ' ' + bb.y + ' ' + bb.width + ' ' + bb.height;\n        markerWidth = bb.width / 10;\n        markerHeight = bb.height / 10;\n\n        const box = addElem({\n          element: 'rect',\n          attr: {\n            x: bb.x,\n            y: bb.y,\n            width: bb.width,\n            height: bb.height,\n            fill: txtBoxBg,\n            stroke: txtBoxBorder,\n            'stroke-width': txtBoxStrokeWidth\n          }\n        });\n        marker.setAttribute('orient', 0);\n        marker.append(box, text);\n      }\n\n      marker.setAttribute('viewBox', viewBox);\n      marker.setAttribute('markerWidth', markerWidth);\n      marker.setAttribute('markerHeight', markerHeight);\n      marker.setAttribute('refX', refX);\n      marker.setAttribute('refY', refY);\n      svgCanvas.findDefs().append(marker);\n\n      return marker;\n    }\n\n    /**\n    * @param {Element} elem\n    * @returns {SVGPolylineElement}\n    */\n    function convertline (elem) {\n      // this routine came from the connectors extension\n      // it is needed because midpoint markers don't work with line elements\n      if (elem.tagName !== 'line') { return elem; }\n\n      // Convert to polyline to accept mid-arrow\n\n      const x1 = Number(elem.getAttribute('x1'));\n      const x2 = Number(elem.getAttribute('x2'));\n      const y1 = Number(elem.getAttribute('y1'));\n      const y2 = Number(elem.getAttribute('y2'));\n      const {id} = elem;\n\n      const midPt = (' ' + ((x1 + x2) / 2) + ',' + ((y1 + y2) / 2) + ' ');\n      const pline = addElem({\n        element: 'polyline',\n        attr: {\n          points: (x1 + ',' + y1 + midPt + x2 + ',' + y2),\n          stroke: elem.getAttribute('stroke'),\n          'stroke-width': elem.getAttribute('stroke-width'),\n          fill: 'none',\n          opacity: elem.getAttribute('opacity') || 1\n        }\n      });\n      $.each(mtypes, function (i, pos) { // get any existing marker definitions\n        const nam = 'marker-' + pos;\n        const m = elem.getAttribute(nam);\n        if (m) { pline.setAttribute(nam, elem.getAttribute(nam)); }\n      });\n\n      const batchCmd = new S.BatchCommand();\n      batchCmd.addSubCommand(new S.RemoveElementCommand(elem, elem.parentNode));\n      batchCmd.addSubCommand(new S.InsertElementCommand(pline));\n\n      $(elem).after(pline).remove();\n      svgCanvas.clearSelection();\n      pline.id = id;\n      svgCanvas.addToSelection([pline]);\n      S.addCommandToHistory(batchCmd);\n      return pline;\n    }\n\n    /**\n    *\n    * @returns {void}\n    */\n    function setMarker () {\n      const poslist = {start_marker: 'start', mid_marker: 'mid', end_marker: 'end'};\n      const pos = poslist[this.id];\n      const markerName = 'marker-' + pos;\n      const el = selElems[0];\n      const marker = getLinked(el, markerName);\n      if (marker) { $(marker).remove(); }\n      el.removeAttribute(markerName);\n      let val = this.value;\n      if (val === '') { val = '\\\\nomarker'; }\n      if (val === '\\\\nomarker') {\n        setIcon(pos, val);\n        svgCanvas.call('changed', selElems);\n        return;\n      }\n      // Set marker on element\n      const id = markerPrefix + pos + '_' + el.id;\n      addMarker(id, val);\n      svgCanvas.changeSelectedAttribute(markerName, 'url(#' + id + ')');\n      if (el.tagName === 'line' && pos === 'mid') {\n        convertline(el);\n      }\n      svgCanvas.call('changed', selElems);\n      setIcon(pos, val);\n    }\n\n    /**\n     * Called when the main system modifies an object. This routine changes\n     *   the associated markers to be the same color.\n     * @param {Element} elem\n     * @returns {void}\n    */\n    function colorChanged (elem) {\n      const color = elem.getAttribute('stroke');\n\n      $.each(mtypes, function (i, pos) {\n        const marker = getLinked(elem, 'marker-' + pos);\n        if (!marker) { return; }\n        if (!marker.attributes.se_type) { return; } // not created by this extension\n        const ch = marker.lastElementChild;\n        if (!ch) { return; }\n        const curfill = ch.getAttribute('fill');\n        const curstroke = ch.getAttribute('stroke');\n        if (curfill && curfill !== 'none') { ch.setAttribute('fill', color); }\n        if (curstroke && curstroke !== 'none') { ch.setAttribute('stroke', color); }\n      });\n    }\n\n    /**\n    * Called when the main system creates or modifies an object.\n    * Its primary purpose is to create new markers for cloned objects.\n    * @param {Element} el\n    * @returns {void}\n    */\n    function updateReferences (el) {\n      $.each(mtypes, function (i, pos) {\n        const id = markerPrefix + pos + '_' + el.id;\n        const markerName = 'marker-' + pos;\n        const marker = getLinked(el, markerName);\n        if (!marker || !marker.attributes.se_type) { return; } // not created by this extension\n        const url = el.getAttribute(markerName);\n        if (url) {\n          const len = el.id.length;\n          const linkid = url.substr(-len - 1, len);\n          if (el.id !== linkid) {\n            const val = $('#' + pos + '_marker').attr('value');\n            addMarker(id, val);\n            svgCanvas.changeSelectedAttribute(markerName, 'url(#' + id + ')');\n            if (el.tagName === 'line' && pos === 'mid') { el = convertline(el); }\n            svgCanvas.call('changed', selElems);\n          }\n        }\n      });\n    }\n\n    // simulate a change event a text box that stores the current element's marker type\n    /**\n    * @param {\"start\"|\"mid\"|\"end\"} pos\n    * @param {string} val\n    * @returns {void}\n    */\n    function triggerTextEntry (pos, val) {\n      $('#' + pos + '_marker').val(val);\n      $('#' + pos + '_marker').change();\n      // const txtbox = $('#'+pos+'_marker');\n      // if (val.substr(0,1)=='\\\\') {txtbox.hide();}\n      // else {txtbox.show();}\n    }\n\n    /**\n    * @param {\"start\"|\"mid\"|\"end\"} pos\n    * @returns {Promise<void>} Resolves to `undefined`\n    */\n    async function showTextPrompt (pos) {\n      let def = $('#' + pos + '_marker').val();\n      if (def.substr(0, 1) === '\\\\') { def = ''; }\n      const txt = await $.prompt('Enter text for ' + pos + ' marker', def);\n      if (txt) {\n        triggerTextEntry(pos, txt);\n      }\n    }\n\n    /*\n    function setMarkerSet(obj) {\n      const parts = this.id.split('_');\n      const set = parts[2];\n      switch (set) {\n      case 'off':\n        triggerTextEntry('start','\\\\nomarker');\n        triggerTextEntry('mid','\\\\nomarker');\n        triggerTextEntry('end','\\\\nomarker');\n        break;\n      case 'dimension':\n        triggerTextEntry('start','\\\\leftarrow');\n        triggerTextEntry('end','\\\\rightarrow');\n        await showTextPrompt('mid');\n        break;\n      case 'label':\n        triggerTextEntry('mid','\\\\nomarker');\n        triggerTextEntry('end','\\\\rightarrow');\n        await showTextPrompt('start');\n        break;\n      }\n    }\n    */\n\n    // callback function for a toolbar button click\n    /**\n    * @param {Event} ev\n    * @returns {Promise<void>} Resolves to `undefined`\n    */\n    async function setArrowFromButton (ev) {\n      const parts = this.id.split('_');\n      const pos = parts[1];\n      let val = parts[2];\n      if (parts[3]) { val += '_' + parts[3]; }\n\n      if (val !== 'textmarker') {\n        triggerTextEntry(pos, '\\\\' + val);\n      } else {\n        await showTextPrompt(pos);\n      }\n    }\n\n    /**\n    * @param {\"nomarker\"|\"leftarrow\"|\"rightarrow\"|\"textmarker\"|\"forwardslash\"|\"reverseslash\"|\"verticalslash\"|\"box\"|\"star\"|\"xmark\"|\"triangle\"|\"mcircle\"} id\n    * @returns {string}\n    */\n    function getTitle (id) {\n      const {langList} = strings;\n      const item = langList.find((itm) => {\n        return itm.id === id;\n      });\n      return item ? item.title : id;\n    }\n\n    /**\n    * Build the toolbar button array from the marker definitions.\n    * @returns {module:SVGEditor.Button[]}\n    */\n    function buildButtonList () {\n      const buttons = [];\n      // const i = 0;\n      /*\n      buttons.push({\n        id: idPrefix + 'markers_off',\n        title: 'Turn off all markers',\n        type: 'context',\n        events: { click: setMarkerSet },\n        panel: 'marker_panel'\n      });\n      buttons.push({\n        id: idPrefix + 'markers_dimension',\n        title: 'Dimension',\n        type: 'context',\n        events: { click: setMarkerSet },\n        panel: 'marker_panel'\n      });\n      buttons.push({\n        id: idPrefix + 'markers_label',\n        title: 'Label',\n        type: 'context',\n        events: { click: setMarkerSet },\n        panel: 'marker_panel'\n      });\n  */\n      $.each(mtypes, function (k, pos) {\n        const listname = pos + '_marker_list';\n        let def = true;\n        Object.keys(markerTypes).forEach(function (id) {\n          const title = getTitle(String(id));\n          buttons.push({\n            id: idPrefix + pos + '_' + id,\n            svgicon: id,\n            icon: svgEditor.curConfig.extIconsPath + 'markers-' + id + '.png',\n            title,\n            type: 'context',\n            events: {click: setArrowFromButton},\n            panel: 'marker_panel',\n            list: listname,\n            isDefault: def\n          });\n          def = false;\n        });\n      });\n      return buttons;\n    }\n\n    const contextTools = [\n      {\n        type: 'input',\n        panel: 'marker_panel',\n        id: 'start_marker',\n        size: 3,\n        events: {change: setMarker}\n      }, {\n        type: 'button-select',\n        panel: 'marker_panel',\n        id: 'start_marker_list',\n        colnum: 3,\n        events: {change: setArrowFromButton}\n      }, {\n        type: 'input',\n        panel: 'marker_panel',\n        id: 'mid_marker',\n        defval: '',\n        size: 3,\n        events: {change: setMarker}\n      }, {\n        type: 'button-select',\n        panel: 'marker_panel',\n        id: 'mid_marker_list',\n        colnum: 3,\n        events: {change: setArrowFromButton}\n      }, {\n        type: 'input',\n        panel: 'marker_panel',\n        id: 'end_marker',\n        size: 3,\n        events: {change: setMarker}\n      }, {\n        type: 'button-select',\n        panel: 'marker_panel',\n        id: 'end_marker_list',\n        colnum: 3,\n        events: {change: setArrowFromButton}\n      }\n    ];\n\n    return {\n      name: strings.name,\n      svgicons: svgEditor.curConfig.extIconsPath + 'markers-icons.xml',\n      callback () {\n        $('#marker_panel').addClass('toolset').hide();\n      },\n      /* async */ addLangData ({importLocale, lang}) {\n        return {data: strings.langList};\n      },\n      selectedChanged (opts) {\n        // Use this to update the current selected elements\n        // console.log('selectChanged',opts);\n        selElems = opts.elems;\n\n        const markerElems = ['line', 'path', 'polyline', 'polygon'];\n\n        let i = selElems.length;\n        while (i--) {\n          const elem = selElems[i];\n          if (elem && markerElems.includes(elem.tagName)) {\n            if (opts.selectedElement && !opts.multiselected) {\n              showPanel(true);\n            } else {\n              showPanel(false);\n            }\n          } else {\n            showPanel(false);\n          }\n        }\n      },\n\n      elementChanged (opts) {\n        // console.log('elementChanged',opts);\n        const elem = opts.elems[0];\n        if (elem && (\n          elem.getAttribute('marker-start') ||\n          elem.getAttribute('marker-mid') ||\n          elem.getAttribute('marker-end')\n        )) {\n          colorChanged(elem);\n          updateReferences(elem);\n        }\n        // changing_flag = false; // Not apparently in use\n      },\n      buttons: buildButtonList(),\n      context_tools: strings.contextTools.map((contextTool, i) => {\n        return Object.assign(contextTools[i], contextTool);\n      })\n    };\n  }\n};\n"],"names":["name","init","S","getLinked","setIcon","showPanel","addMarker","convertline","setMarker","colorChanged","updateReferences","triggerTextEntry","showTextPrompt","setArrowFromButton","getTitle","buildButtonList","buttons","$","each","mtypes","k","pos","listname","def","Object","keys","markerTypes","forEach","id","title","String","push","idPrefix","svgicon","icon","svgEditor","curConfig","extIconsPath","type","events","click","panel","list","isDefault","langList","strings","item","find","itm","ev","parts","split","val","substr","prompt","txt","change","el","i","markerPrefix","markerName","marker","attributes","se_type","url","getAttribute","len","length","linkid","attr","svgCanvas","changeSelectedAttribute","tagName","call","selElems","elem","color","ch","lastElementChild","curfill","curstroke","setAttribute","poslist","start_marker","mid_marker","end_marker","remove","removeAttribute","value","x1","Number","x2","y1","y2","midPt","pline","addElem","element","points","stroke","fill","opacity","nam","m","batchCmd","BatchCommand","addSubCommand","RemoveElementCommand","parentNode","InsertElementCommand","after","clearSelection","addToSelection","addCommandToHistory","txtBoxBg","txtBoxBorder","txtBoxStrokeWidth","getElem","undefined","strokeWidth","refX","refY","viewBox","markerWidth","markerHeight","seType","markerUnits","orient","style","mel","fillcolor","append","text","textContent","tb","getBBox","pad","bb","x","y","width","height","box","findDefs","on","toggle","ci","txtbox","hide","lastChild","children","addClass","siblings","removeClass","str","match","importLocale","canvas","addSVGElementFromJson","nomarker","leftarrow","d","rightarrow","textmarker","forwardslash","reverseslash","verticalslash","star","xmark","triangle","mcircle","r","cx","cy","v","contextTools","size","colnum","defval","svgicons","callback","addLangData","lang","data","selectedChanged","opts","elems","markerElems","includes","selectedElement","multiselected","elementChanged","context_tools","map","contextTool","assign"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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"}