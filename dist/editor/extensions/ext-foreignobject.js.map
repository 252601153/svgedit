{"version":3,"file":"ext-foreignobject.js","sources":["../../../src/editor/extensions/ext-foreignobject.js"],"sourcesContent":["/**\n * @file ext-foreignobject.js\n *\n * @license Apache-2.0\n *\n * @copyright 2010 Jacques Distler, 2010 Alexis Deveria\n *\n */\n\nexport default {\n  name: 'foreignobject',\n  async init (S) {\n    const svgEditor = this;\n    const {$, text2xml, NS, importLocale} = S;\n    const svgCanvas = svgEditor.canvas;\n    const\n      // {svgcontent} = S,\n      // addElem = svgCanvas.addSVGElementFromJson,\n      svgdoc = S.svgroot.parentNode.ownerDocument;\n    const strings = await importLocale();\n\n    const properlySourceSizeTextArea = function () {\n      // TODO: remove magic numbers here and get values from CSS\n      const height = $('#svg_source_container').height() - 80;\n      $('#svg_source_textarea').css('height', height);\n    };\n\n    /**\n    * @param {boolean} on\n    * @returns {void}\n    */\n    function showPanel (on) {\n      let fcRules = $('#fc_rules');\n      if (!fcRules.length) {\n        fcRules = $('<style id=\"fc_rules\"></style>').appendTo('head');\n      }\n      fcRules.text(!on ? '' : ' #tool_topath { display: none !important; }');\n      $('#foreignObject_panel').toggle(on);\n    }\n\n    /**\n    * @param {boolean} on\n    * @returns {void}\n    */\n    function toggleSourceButtons (on) {\n      $('#tool_source_save, #tool_source_cancel').toggle(!on);\n      $('#foreign_save, #foreign_cancel').toggle(on);\n    }\n\n    let selElems,\n      started,\n      newFO,\n      editingforeign = false;\n\n    /**\n    * This function sets the content of element elt to the input XML.\n    * @param {string} xmlString - The XML text\n    * @returns {boolean} This function returns false if the set was unsuccessful, true otherwise.\n    */\n    function setForeignString (xmlString) {\n      const elt = selElems[0]; // The parent `Element` to append to\n      try {\n        // convert string into XML document\n        const newDoc = text2xml('<svg xmlns=\"' + NS.SVG + '\" xmlns:xlink=\"' + NS.XLINK + '\">' + xmlString + '</svg>');\n        // run it through our sanitizer to remove anything we do not support\n        svgCanvas.sanitizeSvg(newDoc.documentElement);\n        elt.replaceWith(svgdoc.importNode(newDoc.documentElement.firstChild, true));\n        svgCanvas.call('changed', [elt]);\n        svgCanvas.clearSelection();\n      } catch (e) {\n        // Todo: Surface error to user\n        console.log(e); // eslint-disable-line no-console\n        return false;\n      }\n\n      return true;\n    }\n\n    /**\n    *\n    * @returns {void}\n    */\n    function showForeignEditor () {\n      const elt = selElems[0];\n      if (!elt || editingforeign) { return; }\n      editingforeign = true;\n      toggleSourceButtons(true);\n      elt.removeAttribute('fill');\n\n      const str = svgCanvas.svgToString(elt, 0);\n      $('#svg_source_textarea').val(str);\n      $('#svg_source_editor').fadeIn();\n      properlySourceSizeTextArea();\n      $('#svg_source_textarea').focus();\n    }\n\n    /**\n    * @param {string} attr\n    * @param {string|Float} val\n    * @returns {void}\n    */\n    function setAttr (attr, val) {\n      svgCanvas.changeSelectedAttribute(attr, val);\n      svgCanvas.call('changed', selElems);\n    }\n\n    const buttons = [{\n      id: 'tool_foreign',\n      icon: 'foreignobject-tool.png',\n      type: 'mode',\n      events: {\n        click () {\n          svgCanvas.setMode('foreign');\n        }\n      }\n    }, {\n      id: 'edit_foreign',\n      icon: 'foreignobject-edit.png',\n      type: 'context',\n      panel: 'foreignObject_panel',\n      events: {\n        click () {\n          showForeignEditor();\n        }\n      }\n    }];\n\n    const contextTools = [\n      {\n        type: 'input',\n        panel: 'foreignObject_panel',\n        id: 'foreign_width',\n        size: 3,\n        events: {\n          change () {\n            setAttr('width', this.value);\n          }\n        }\n      }, {\n        type: 'input',\n        panel: 'foreignObject_panel',\n        id: 'foreign_height',\n        events: {\n          change () {\n            setAttr('height', this.value);\n          }\n        }\n      }, {\n        type: 'input',\n        panel: 'foreignObject_panel',\n        id: 'foreign_font_size',\n        size: 2,\n        defval: 16,\n        events: {\n          change () {\n            setAttr('font-size', this.value);\n          }\n        }\n      }\n    ];\n\n    return {\n      name: strings.name,\n      svgicons: 'foreignobject-icons.xml',\n      buttons: strings.buttons.map((button, i) => {\n        return Object.assign(buttons[i], button);\n      }),\n      context_tools: strings.contextTools.map((contextTool, i) => {\n        return Object.assign(contextTools[i], contextTool);\n      }),\n      callback () {\n        $('#foreignObject_panel').hide();\n\n        const endChanges = function () {\n          $('#svg_source_editor').hide();\n          editingforeign = false;\n          $('#svg_source_textarea').blur();\n          toggleSourceButtons(false);\n        };\n\n        // TODO: Needs to be done after orig icon loads\n        setTimeout(function () {\n          // Create source save/cancel buttons\n          /* const save = */ $('#tool_source_save').clone()\n            .hide().attr('id', 'foreign_save').unbind()\n            .appendTo('#tool_source_back').click(async function () {\n              if (!editingforeign) { return; }\n\n              if (!setForeignString($('#svg_source_textarea').val())) {\n                const ok = await $.confirm('Errors found. Revert to original?');\n                if (!ok) { return; }\n                endChanges();\n              } else {\n                endChanges();\n              }\n              // setSelectMode();\n            });\n\n          /* const cancel = */ $('#tool_source_cancel').clone()\n            .hide().attr('id', 'foreign_cancel').unbind()\n            .appendTo('#tool_source_back').click(function () {\n              endChanges();\n            });\n        }, 3000);\n      },\n      mouseDown (opts) {\n        // const e = opts.event;\n        if (svgCanvas.getMode() !== 'foreign') {\n          return undefined;\n        }\n        started = true;\n        newFO = svgCanvas.addSVGElementFromJson({\n          element: 'foreignObject',\n          attr: {\n            x: opts.start_x,\n            y: opts.start_y,\n            id: svgCanvas.getNextId(),\n            'font-size': 16, // cur_text.font_size,\n            width: '48',\n            height: '20',\n            style: 'pointer-events:inherit'\n          }\n        });\n        const m = svgdoc.createElementNS(NS.MATH, 'math');\n        m.setAttributeNS(NS.XMLNS, 'xmlns', NS.MATH);\n        m.setAttribute('display', 'inline');\n        const mi = svgdoc.createElementNS(NS.MATH, 'mi');\n        mi.setAttribute('mathvariant', 'normal');\n        mi.textContent = '\\u03A6';\n        const mo = svgdoc.createElementNS(NS.MATH, 'mo');\n        mo.textContent = '\\u222A';\n        const mi2 = svgdoc.createElementNS(NS.MATH, 'mi');\n        mi2.textContent = '\\u2133';\n        m.append(mi, mo, mi2);\n        newFO.append(m);\n        return {\n          started: true\n        };\n      },\n      mouseUp (opts) {\n        // const e = opts.event;\n        if (svgCanvas.getMode() !== 'foreign' || !started) {\n          return undefined;\n        }\n        const attrs = $(newFO).attr(['width', 'height']);\n        const keep = (attrs.width !== '0' || attrs.height !== '0');\n        svgCanvas.addToSelection([newFO], true);\n\n        return {\n          keep,\n          element: newFO\n        };\n      },\n      selectedChanged (opts) {\n        // Use this to update the current selected elements\n        selElems = opts.elems;\n\n        let i = selElems.length;\n        while (i--) {\n          const elem = selElems[i];\n          if (elem && elem.tagName === 'foreignObject') {\n            if (opts.selectedElement && !opts.multiselected) {\n              $('#foreign_font_size').val(elem.getAttribute('font-size'));\n              $('#foreign_width').val(elem.getAttribute('width'));\n              $('#foreign_height').val(elem.getAttribute('height'));\n              showPanel(true);\n            } else {\n              showPanel(false);\n            }\n          } else {\n            showPanel(false);\n          }\n        }\n      },\n      elementChanged (opts) {\n        // const elem = opts.elems[0];\n      }\n    };\n  }\n};\n"],"names":["name","init","S","showPanel","toggleSourceButtons","setForeignString","showForeignEditor","setAttr","attr","val","svgCanvas","changeSelectedAttribute","call","selElems","elt","editingforeign","removeAttribute","str","svgToString","$","fadeIn","properlySourceSizeTextArea","focus","xmlString","newDoc","text2xml","NS","SVG","XLINK","sanitizeSvg","documentElement","replaceWith","svgdoc","importNode","firstChild","clearSelection","e","console","log","on","toggle","fcRules","length","appendTo","text","svgEditor","importLocale","canvas","svgroot","parentNode","ownerDocument","strings","height","css","buttons","id","icon","type","events","click","setMode","panel","contextTools","size","change","value","defval","svgicons","map","button","i","Object","assign","context_tools","contextTool","callback","hide","endChanges","blur","setTimeout","clone","unbind","confirm","ok","mouseDown","opts","getMode","undefined","started","newFO","addSVGElementFromJson","element","x","start_x","y","start_y","getNextId","width","style","m","createElementNS","MATH","setAttributeNS","XMLNS","setAttribute","mi","textContent","mo","mi2","append","mouseUp","attrs","keep","addToSelection","selectedChanged","elems","elem","tagName","selectedElement","multiselected","getAttribute","elementChanged"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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"}