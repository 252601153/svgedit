{"version":3,"file":"ext-xdomain-messaging.js","sources":["../../../src/editor/extensions/ext-xdomain-messaging.js"],"sourcesContent":["/**\n* Should not be needed for same domain control (just call via child frame),\n*  but an API common for cross-domain and same domain use can be found\n*  in embedapi.js with a demo at embedapi.html.\n*/\nexport default {\n  name: 'xdomain-messaging',\n  init () {\n    const svgEditor = this;\n    const svgCanvas = svgEditor.canvas;\n    try {\n      window.addEventListener('message', function (e) {\n        // We accept and post strings for the sake of IE9 support\n        if (!e.data || !['string', 'object'].includes(typeof e.data) || e.data.charAt() === '|') {\n          return;\n        }\n        const data = typeof e.data === 'object' ? e.data : JSON.parse(e.data);\n        if (!data || typeof data !== 'object' || data.namespace !== 'svgCanvas') {\n          return;\n        }\n        // The default is not to allow any origins, including even the same domain or\n        //  if run on a `file:///` URL. See `svgedit-config-es.js` for an example of how\n        //  to configure\n        const {allowedOrigins} = svgEditor.curConfig;\n        if (!allowedOrigins.includes('*') && !allowedOrigins.includes(e.origin)) {\n          console.log(`Origin ${e.origin} not whitelisted for posting to ${window.origin}`); // eslint-disable-line no-console\n          return;\n        }\n        const cbid = data.id;\n        const {name, args} = data;\n        const message = {\n          namespace: 'svg-edit',\n          id: cbid\n        };\n        try {\n          // Now that we know the origin is trusted, we perform otherwise\n          //   unsafe arbitrary canvas method execution\n          message.result = svgCanvas[name](...args); // lgtm [js/remote-property-injection]\n        } catch (err) {\n          message.error = err.message;\n        }\n        e.source.postMessage(JSON.stringify(message), '*');\n      });\n    } catch (err) {\n      console.log('Error with xdomain message listener: ' + err); // eslint-disable-line no-console\n    }\n  }\n};\n"],"names":["name","init","svgEditor","svgCanvas","canvas","window","addEventListener","e","data","includes","charAt","JSON","parse","namespace","allowedOrigins","curConfig","origin","console","log","cbid","id","args","message","result","err","error","source","postMessage","stringify"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;AAKA,0BAAe;AACbA,EAAAA,IAAI,EAAE,mBADO;AAEbC,EAAAA,IAFa,kBAEL;AACN,QAAMC,SAAS,GAAG,IAAlB;AACA,QAAMC,SAAS,GAAGD,SAAS,CAACE,MAA5B;;AACA,QAAI;AACFC,MAAAA,MAAM,CAACC,gBAAP,CAAwB,SAAxB,EAAmC,UAAUC,CAAV,EAAa;AAC9C;AACA,YAAI,CAACA,CAAC,CAACC,IAAH,IAAW,CAAC,CAAC,QAAD,EAAW,QAAX,EAAqBC,QAArB,SAAqCF,CAAC,CAACC,IAAvC,EAAZ,IAA4DD,CAAC,CAACC,IAAF,CAAOE,MAAP,OAAoB,GAApF,EAAyF;AACvF;AACD;;AACD,YAAMF,IAAI,GAAG,QAAOD,CAAC,CAACC,IAAT,MAAkB,QAAlB,GAA6BD,CAAC,CAACC,IAA/B,GAAsCG,IAAI,CAACC,KAAL,CAAWL,CAAC,CAACC,IAAb,CAAnD;;AACA,YAAI,CAACA,IAAD,IAAS,QAAOA,IAAP,MAAgB,QAAzB,IAAqCA,IAAI,CAACK,SAAL,KAAmB,WAA5D,EAAyE;AACvE;AACD,SAR6C;AAU9C;AACA;;;AAX8C,YAYvCC,cAZuC,GAYrBZ,SAAS,CAACa,SAZW,CAYvCD,cAZuC;;AAa9C,YAAI,CAACA,cAAc,CAACL,QAAf,CAAwB,GAAxB,CAAD,IAAiC,CAACK,cAAc,CAACL,QAAf,CAAwBF,CAAC,CAACS,MAA1B,CAAtC,EAAyE;AACvEC,UAAAA,OAAO,CAACC,GAAR,kBAAsBX,CAAC,CAACS,MAAxB,6CAAiEX,MAAM,CAACW,MAAxE,GADuE;;AAEvE;AACD;;AACD,YAAMG,IAAI,GAAGX,IAAI,CAACY,EAAlB;AAjB8C,YAkBvCpB,IAlBuC,GAkBzBQ,IAlByB,CAkBvCR,IAlBuC;AAAA,YAkBjCqB,IAlBiC,GAkBzBb,IAlByB,CAkBjCa,IAlBiC;AAmB9C,YAAMC,OAAO,GAAG;AACdT,UAAAA,SAAS,EAAE,UADG;AAEdO,UAAAA,EAAE,EAAED;AAFU,SAAhB;;AAIA,YAAI;AACF;AACA;AACAG,UAAAA,OAAO,CAACC,MAAR,GAAiBpB,SAAS,CAACH,IAAD,CAAT,OAAAG,SAAS,qBAAUkB,IAAV,EAA1B,CAHE;AAIH,SAJD,CAIE,OAAOG,GAAP,EAAY;AACZF,UAAAA,OAAO,CAACG,KAAR,GAAgBD,GAAG,CAACF,OAApB;AACD;;AACDf,QAAAA,CAAC,CAACmB,MAAF,CAASC,WAAT,CAAqBhB,IAAI,CAACiB,SAAL,CAAeN,OAAf,CAArB,EAA8C,GAA9C;AACD,OA/BD;AAgCD,KAjCD,CAiCE,OAAOE,GAAP,EAAY;AACZP,MAAAA,OAAO,CAACC,GAAR,CAAY,0CAA0CM,GAAtD,EADY;AAEb;AACF;AAzCY,CAAf;;;;"}