{"version":3,"file":"ext-arrows.js","sources":["../../../src/editor/extensions/ext-arrows.js"],"sourcesContent":["/**\n * @file ext-arrows.js\n *\n * @license MIT\n *\n * @copyright 2010 Alexis Deveria\n *\n */\n\nexport default {\n  name: 'arrows',\n  async init (S) {\n    const strings = await S.importLocale();\n    const svgEditor = this;\n    const svgCanvas = svgEditor.canvas;\n    const // {svgcontent} = S,\n      addElem = svgCanvas.addSVGElementFromJson,\n      {nonce, $} = S,\n      prefix = 'se_arrow_';\n\n    let selElems, arrowprefix, randomizeIds = S.randomize_ids;\n\n    /**\n    * @param {Window} win\n    * @param {!(string|Integer)} n\n    * @returns {void}\n    */\n    function setArrowNonce (win, n) {\n      randomizeIds = true;\n      arrowprefix = prefix + n + '_';\n      pathdata.fw.id = arrowprefix + 'fw';\n      pathdata.bk.id = arrowprefix + 'bk';\n    }\n\n    /**\n    * @param {Window} win\n    * @returns {void}\n    */\n    function unsetArrowNonce (win) {\n      randomizeIds = false;\n      arrowprefix = prefix;\n      pathdata.fw.id = arrowprefix + 'fw';\n      pathdata.bk.id = arrowprefix + 'bk';\n    }\n\n    svgCanvas.bind('setnonce', setArrowNonce);\n    svgCanvas.bind('unsetnonce', unsetArrowNonce);\n\n    if (randomizeIds) {\n      arrowprefix = prefix + nonce + '_';\n    } else {\n      arrowprefix = prefix;\n    }\n\n    const pathdata = {\n      fw: {d: 'm0,0l10,5l-10,5l5,-5l-5,-5z', refx: 8, id: arrowprefix + 'fw'},\n      bk: {d: 'm10,0l-10,5l10,5l-5,-5l5,-5z', refx: 2, id: arrowprefix + 'bk'}\n    };\n\n    /**\n     * Gets linked element.\n     * @param {Element} elem\n     * @param {string} attr\n     * @returns {Element}\n    */\n    function getLinked (elem, attr) {\n      const str = elem.getAttribute(attr);\n      if (!str) { return null; }\n      const m = str.match(/\\(#(.*)\\)/);\n      // const m = str.match(/\\(#(?<id>.+)\\)/);\n      // if (!m || !m.groups.id) {\n      if (!m || m.length !== 2) {\n        return null;\n      }\n      return svgCanvas.getElem(m[1]);\n      // return svgCanvas.getElem(m.groups.id);\n    }\n\n    /**\n    * @param {boolean} on\n    * @returns {void}\n    */\n    function showPanel (on) {\n      $('#arrow_panel').toggle(on);\n      if (on) {\n        const el = selElems[0];\n        const end = el.getAttribute('marker-end');\n        const start = el.getAttribute('marker-start');\n        const mid = el.getAttribute('marker-mid');\n        let val;\n        if (end && start) {\n          val = 'both';\n        } else if (end) {\n          val = 'end';\n        } else if (start) {\n          val = 'start';\n        } else if (mid) {\n          val = 'mid';\n          if (mid.includes('bk')) {\n            val = 'mid_bk';\n          }\n        }\n\n        if (!start && !mid && !end) {\n          val = 'none';\n        }\n\n        $('#arrow_list').val(val);\n      }\n    }\n\n    /**\n    *\n    * @returns {void}\n    */\n    function resetMarker () {\n      const el = selElems[0];\n      el.removeAttribute('marker-start');\n      el.removeAttribute('marker-mid');\n      el.removeAttribute('marker-end');\n    }\n\n    /**\n    * @param {\"bk\"|\"fw\"} dir\n    * @param {\"both\"|\"mid\"|\"end\"|\"start\"} type\n    * @param {string} id\n    * @returns {Element}\n    */\n    function addMarker (dir, type, id) {\n      // TODO: Make marker (or use?) per arrow type, since refX can be different\n      id = id || arrowprefix + dir;\n\n      const data = pathdata[dir];\n\n      if (type === 'mid') {\n        data.refx = 5;\n      }\n\n      let marker = svgCanvas.getElem(id);\n      if (!marker) {\n        marker = addElem({\n          element: 'marker',\n          attr: {\n            viewBox: '0 0 10 10',\n            id,\n            refY: 5,\n            markerUnits: 'strokeWidth',\n            markerWidth: 5,\n            markerHeight: 5,\n            orient: 'auto',\n            style: 'pointer-events:none' // Currently needed for Opera\n          }\n        });\n        const arrow = addElem({\n          element: 'path',\n          attr: {\n            d: data.d,\n            fill: '#000000'\n          }\n        });\n        marker.append(arrow);\n        svgCanvas.findDefs().append(marker);\n      }\n\n      marker.setAttribute('refX', data.refx);\n\n      return marker;\n    }\n\n    /**\n    *\n    * @returns {void}\n    */\n    function setArrow () {\n      resetMarker();\n\n      let type = this.value;\n      if (type === 'none') {\n        return;\n      }\n\n      // Set marker on element\n      let dir = 'fw';\n      if (type === 'mid_bk') {\n        type = 'mid';\n        dir = 'bk';\n      } else if (type === 'both') {\n        addMarker('bk', type);\n        svgCanvas.changeSelectedAttribute('marker-start', 'url(#' + pathdata.bk.id + ')');\n        type = 'end';\n        dir = 'fw';\n      } else if (type === 'start') {\n        dir = 'bk';\n      }\n\n      addMarker(dir, type);\n      svgCanvas.changeSelectedAttribute('marker-' + type, 'url(#' + pathdata[dir].id + ')');\n      svgCanvas.call('changed', selElems);\n    }\n\n    /**\n    * @param {Element} elem\n    * @returns {void}\n    */\n    function colorChanged (elem) {\n      const color = elem.getAttribute('stroke');\n      const mtypes = ['start', 'mid', 'end'];\n      const defs = svgCanvas.findDefs();\n\n      $.each(mtypes, function (i, type) {\n        const marker = getLinked(elem, 'marker-' + type);\n        if (!marker) { return; }\n\n        const curColor = $(marker).children().attr('fill');\n        const curD = $(marker).children().attr('d');\n        if (curColor === color) { return; }\n\n        const allMarkers = $(defs).find('marker');\n        let newMarker = null;\n        // Different color, check if already made\n        allMarkers.each(function () {\n          const attrs = $(this).children().attr(['fill', 'd']);\n          if (attrs.fill === color && attrs.d === curD) {\n            // Found another marker with this color and this path\n            newMarker = this;\n          }\n        });\n\n        if (!newMarker) {\n          // Create a new marker with this color\n          const lastId = marker.id;\n          const dir = lastId.includes('_fw') ? 'fw' : 'bk';\n\n          newMarker = addMarker(dir, type, arrowprefix + dir + allMarkers.length);\n\n          $(newMarker).children().attr('fill', color);\n        }\n\n        $(elem).attr('marker-' + type, 'url(#' + newMarker.id + ')');\n\n        // Check if last marker can be removed\n        let remove = true;\n        $(S.svgcontent).find('line, polyline, path, polygon').each(function () {\n          const element = this;\n          $.each(mtypes, function (j, mtype) {\n            if ($(element).attr('marker-' + mtype) === 'url(#' + marker.id + ')') {\n              remove = false;\n              return remove;\n            }\n            return undefined;\n          });\n          if (!remove) { return false; }\n          return undefined;\n        });\n\n        // Not found, so can safely remove\n        if (remove) {\n          $(marker).remove();\n        }\n      });\n    }\n\n    const contextTools = [\n      {\n        type: 'select',\n        panel: 'arrow_panel',\n        id: 'arrow_list',\n        defval: 'none',\n        events: {\n          change: setArrow\n        }\n      }\n    ];\n\n    return {\n      name: strings.name,\n      context_tools: strings.contextTools.map((contextTool, i) => {\n        return Object.assign(contextTools[i], contextTool);\n      }),\n      callback () {\n        $('#arrow_panel').hide();\n        // Set ID so it can be translated in locale file\n        $('#arrow_list option')[0].id = 'connector_no_arrow';\n      },\n      async addLangData ({lang, importLocale}) {\n        const {langList} = await importLocale();\n        return {\n          data: langList\n        };\n      },\n      selectedChanged (opts) {\n        // Use this to update the current selected elements\n        selElems = opts.elems;\n\n        const markerElems = ['line', 'path', 'polyline', 'polygon'];\n        let i = selElems.length;\n        while (i--) {\n          const elem = selElems[i];\n          if (elem && markerElems.includes(elem.tagName)) {\n            if (opts.selectedElement && !opts.multiselected) {\n              showPanel(true);\n            } else {\n              showPanel(false);\n            }\n          } else {\n            showPanel(false);\n          }\n        }\n      },\n      elementChanged (opts) {\n        const elem = opts.elems[0];\n        if (elem && (\n          elem.getAttribute('marker-start') ||\n          elem.getAttribute('marker-mid') ||\n          elem.getAttribute('marker-end')\n        )) {\n          // const start = elem.getAttribute('marker-start');\n          // const mid = elem.getAttribute('marker-mid');\n          // const end = elem.getAttribute('marker-end');\n          // Has marker, so see if it should match color\n          colorChanged(elem);\n        }\n      }\n    };\n  }\n};\n"],"names":["name","init","S","setArrowNonce","unsetArrowNonce","getLinked","showPanel","resetMarker","addMarker","setArrow","colorChanged","elem","color","getAttribute","mtypes","defs","svgCanvas","findDefs","$","each","i","type","marker","curColor","children","attr","curD","allMarkers","find","newMarker","attrs","fill","d","lastId","id","dir","includes","arrowprefix","length","remove","svgcontent","element","j","mtype","undefined","value","changeSelectedAttribute","pathdata","bk","call","selElems","data","refx","getElem","addElem","viewBox","refY","markerUnits","markerWidth","markerHeight","orient","style","arrow","append","setAttribute","el","removeAttribute","on","toggle","end","start","mid","val","str","m","match","win","randomizeIds","prefix","fw","n","importLocale","strings","svgEditor","canvas","addSVGElementFromJson","nonce","randomize_ids","bind","contextTools","panel","defval","events","change","context_tools","map","contextTool","Object","assign","callback","hide","addLangData","lang","langList","selectedChanged","opts","elems","markerElems","tagName","selectedElement","multiselected","elementChanged"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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"}