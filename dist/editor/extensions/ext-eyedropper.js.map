{"version":3,"file":"ext-eyedropper.js","sources":["../../../src/editor/extensions/eyedropper-icon.xml","../../../src/editor/extensions/ext-eyedropper.js"],"sourcesContent":["export default \"eyedropper-icon.xml\"","/**\n * @file ext-eyedropper.js\n *\n * @license MIT\n *\n * @copyright 2010 Jeff Schiller\n *\n */\n\nimport './eyedropper-icon.xml';\n\nexport default {\n  name: 'eyedropper',\n  async init (S) {\n    const strings = await S.importLocale();\n    const svgEditor = this;\n    const {$, ChangeElementCommand} = S, // , svgcontent,\n      // svgdoc = S.svgroot.parentNode.ownerDocument,\n      svgCanvas = svgEditor.canvas,\n      addToHistory = function (cmd) { svgCanvas.undoMgr.addCommandToHistory(cmd); },\n      currentStyle = {\n        fillPaint: 'red', fillOpacity: 1.0,\n        strokePaint: 'black', strokeOpacity: 1.0,\n        strokeWidth: 5, strokeDashArray: null,\n        opacity: 1.0,\n        strokeLinecap: 'butt',\n        strokeLinejoin: 'miter'\n      };\n\n    /**\n     *\n     * @param {module:svgcanvas.SvgCanvas#event:ext_selectedChanged|module:svgcanvas.SvgCanvas#event:ext_elementChanged} opts\n     * @returns {void}\n     */\n    function getStyle (opts) {\n      // if we are in eyedropper mode, we don't want to disable the eye-dropper tool\n      const mode = svgCanvas.getMode();\n      if (mode === 'eyedropper') { return; }\n\n      const tool = $('#tool_eyedropper');\n      // enable-eye-dropper if one element is selected\n      let elem = null;\n      if (!opts.multiselected && opts.elems[0] &&\n        !['svg', 'g', 'use'].includes(opts.elems[0].nodeName)\n      ) {\n        elem = opts.elems[0];\n        tool.removeClass('disabled');\n        // grab the current style\n        currentStyle.fillPaint = elem.getAttribute('fill') || 'black';\n        currentStyle.fillOpacity = elem.getAttribute('fill-opacity') || 1.0;\n        currentStyle.strokePaint = elem.getAttribute('stroke');\n        currentStyle.strokeOpacity = elem.getAttribute('stroke-opacity') || 1.0;\n        currentStyle.strokeWidth = elem.getAttribute('stroke-width');\n        currentStyle.strokeDashArray = elem.getAttribute('stroke-dasharray');\n        currentStyle.strokeLinecap = elem.getAttribute('stroke-linecap');\n        currentStyle.strokeLinejoin = elem.getAttribute('stroke-linejoin');\n        currentStyle.opacity = elem.getAttribute('opacity') || 1.0;\n      // disable eye-dropper tool\n      } else {\n        tool.addClass('disabled');\n      }\n    }\n\n    const buttons = [\n      {\n        id: 'tool_eyedropper',\n        icon: svgEditor.curConfig.extIconsPath + 'eyedropper.png',\n        type: 'mode',\n        events: {\n          click () {\n            svgCanvas.setMode('eyedropper');\n          }\n        }\n      }\n    ];\n\n    return {\n      name: strings.name,\n      svgicons: svgEditor.curConfig.extIconsPath + 'eyedropper-icon.xml',\n      buttons: strings.buttons.map((button, i) => {\n        return Object.assign(buttons[i], button);\n      }),\n\n      // if we have selected an element, grab its paint and enable the eye dropper button\n      selectedChanged: getStyle,\n      elementChanged: getStyle,\n\n      mouseDown (opts) {\n        const mode = svgCanvas.getMode();\n        if (mode === 'eyedropper') {\n          const e = opts.event;\n          const {target} = e;\n          if (!['svg', 'g', 'use'].includes(target.nodeName)) {\n            const changes = {};\n\n            const change = function (elem, attrname, newvalue) {\n              changes[attrname] = elem.getAttribute(attrname);\n              elem.setAttribute(attrname, newvalue);\n            };\n\n            if (currentStyle.fillPaint) { change(target, 'fill', currentStyle.fillPaint); }\n            if (currentStyle.fillOpacity) { change(target, 'fill-opacity', currentStyle.fillOpacity); }\n            if (currentStyle.strokePaint) { change(target, 'stroke', currentStyle.strokePaint); }\n            if (currentStyle.strokeOpacity) { change(target, 'stroke-opacity', currentStyle.strokeOpacity); }\n            if (currentStyle.strokeWidth) { change(target, 'stroke-width', currentStyle.strokeWidth); }\n            if (currentStyle.strokeDashArray) { change(target, 'stroke-dasharray', currentStyle.strokeDashArray); }\n            if (currentStyle.opacity) { change(target, 'opacity', currentStyle.opacity); }\n            if (currentStyle.strokeLinecap) { change(target, 'stroke-linecap', currentStyle.strokeLinecap); }\n            if (currentStyle.strokeLinejoin) { change(target, 'stroke-linejoin', currentStyle.strokeLinejoin); }\n\n            addToHistory(new ChangeElementCommand(target, changes));\n          }\n        }\n      }\n    };\n  }\n};\n"],"names":["name","init","S","getStyle","opts","mode","svgCanvas","getMode","tool","$","elem","multiselected","elems","includes","nodeName","removeClass","currentStyle","fillPaint","getAttribute","fillOpacity","strokePaint","strokeOpacity","strokeWidth","strokeDashArray","strokeLinecap","strokeLinejoin","opacity","addClass","importLocale","strings","svgEditor","ChangeElementCommand","canvas","addToHistory","cmd","undoMgr","addCommandToHistory","buttons","id","icon","curConfig","extIconsPath","type","events","click","setMode","svgicons","map","button","i","Object","assign","selectedChanged","elementChanged","mouseDown","e","event","target","changes","change","attrname","newvalue","setAttribute"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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"}