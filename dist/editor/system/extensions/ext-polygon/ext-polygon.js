System.register([],(function(e,t){"use strict";return{execute:function(){function asyncGeneratorStep(e,t,n,o,r,s,a){try{var c=e[s](a),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(o,r)}e("default",{name:"polygon",init:function init(e){var n=this;return function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var s=e.apply(t,n);function _next(e){asyncGeneratorStep(s,o,r,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(s,o,r,_next,_throw,"throw",e)}_next(void 0)}))}}(regeneratorRuntime.mark((function _callee(){var o,r,s,a,c,i,l,u,d,p,g,f,h,y;return regeneratorRuntime.wrap((function _callee$(_){for(;;)switch(_.prev=_.next){case 0:return f=function _sec(e){return 1/Math.cos(e)},g=function _cot(e){return 1/Math.tan(e)},p=function _setAttr(e,t){r.changeSelectedAttribute(e,t),r.call("changed",i)},d=function _showPanel(e){var t=s("#fc_rules");t.length||(t=s('<style id="fc_rules"></style>').appendTo("head")),t.text(e?" #tool_topath { display: none !important; }":""),s("#polygon_panel").toggle(e)},r=(o=n).canvas,s=e.$,!1,_.next=9,t.import("./locale/".concat(o.curPrefs.lang,".js"));case 9:return a=_.sent,c=a.default,h=[{id:"tool_polygon",icon:"polygon.png",type:"mode",position:11,events:{click:function click(){r.setMode("polygon"),d(!0)}}}],y=[{type:"input",panel:"polygon_panel",id:"polySides",size:3,defval:5,events:{change:function change(){p("sides",this.value)}}}],_.abrupt("return",{name:c.name,svgicons:"polygon-icons.svg",buttons:c.buttons.map((function(e,t){return Object.assign(h[t],e)})),context_tools:c.contextTools.map((function(e,t){return Object.assign(y[t],e)})),callback:function callback(){s("#polygon_panel").hide(),setTimeout((function(){s("#tool_source_save").clone().hide().attr("id","polygon_save").unbind().appendTo("#tool_source_back").click((function(){})),s("#tool_source_cancel").clone().hide().attr("id","polygon_cancel").unbind().appendTo("#tool_source_back").click((function(){}))}),3e3)},mouseDown:function mouseDown(e){if("polygon"===r.getMode()){var t=r.getColor("fill"),n=r.getColor("stroke"),o=r.getStrokeWidth();return l=!0,u=r.addSVGElementFromJson({element:"polygon",attr:{cx:e.start_x,cy:e.start_y,id:r.getNextId(),shape:"regularPoly",sides:document.getElementById("polySides").value,orient:"x",edge:0,fill:t,strokecolor:n,strokeWidth:o}}),{started:!0}}},mouseMove:function mouseMove(e){if(l&&"polygon"===r.getMode()){var t=s(u).attr(["cx","cy","sides","orient","fill","strokecolor","strokeWidth"]),n=e.mouse_x,o=e.mouse_y,a=t.cx,c=t.cy,i=t.fill,d=t.strokecolor,p=t.strokeWidth,h=t.sides,y=Math.sqrt((n-a)*(n-a)+(o-c)*(o-c))/1.5;u.setAttribute("edge",y);for(var _=y/2*g(Math.PI/h)*f(Math.PI/h),m="",v=0;h>=v;v++){var k=2*Math.PI*v/h;m+=(n=_*Math.cos(k)+a)+","+(o=_*Math.sin(k)+c)+" "}return u.setAttribute("points",m),u.setAttribute("fill",i),u.setAttribute("stroke",d),u.setAttribute("stroke-width",p),{started:!0}}},mouseUp:function mouseUp(e){if("polygon"===r.getMode())return{keep:"0"!==s(u).attr("edge").edge,element:u}},selectedChanged:function selectedChanged(e){for(var t=(i=e.elems).length;t--;){var n=i[t];n&&"regularPoly"===n.getAttribute("shape")&&e.selectedElement&&!e.multiselected?(s("#polySides").val(n.getAttribute("sides")),d(!0)):d(!1)}},elementChanged:function elementChanged(e){}});case 14:case"end":return _.stop()}}),_callee)})))()}})}}}));
